/*
* jQuery plugin that makes elements editable
*
* @author Victor Jonsson (http://victorjonsson.se/)
* @website https://github.com/victorjonsson/jquery-editable/
* @license GPLv2 http://www.gnu.org/licenses/gpl-2.0.html
* @version 1.3.6.dev
* @donations http://victorjonsson.se/donations/
*/
!function(t,e){"use strict"
var i=t(e),n=!1,a=!1,s="data-edit-event",o="data-is-empty",r="ontouchend"in e,l="tinyMCE"in e&&"function"==typeof e.tinyMCE.init,d=t.fn.is,c=0,g=function(){var e=(new Date).getTime()
e-c<250&&t(this).trigger("dbltap"),c=e},h=function(t){if(13==t.keyCode&&t.data.closeOnEnter)a.editable("close")
else if(t.data.toggleFontSize&&t.metaKey&&(38==t.keyCode||40==t.keyCode)){var e=parseInt(n.css("font-size"),10)
return e+=40==t.keyCode?-1:1,n.css("font-size",e+"px"),!1}},f=function(){n[0].scrollHeight!==parseInt(n.attr("data-scroll"),10)&&(n.css("height",n[0].scrollHeight+"px"),n.attr("data-scroll",n[0].scrollHeight))},u=function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},y=function(t,e,i){t.removeAttr("data-is-editing"),0==e.length&&i?(t.html(i),t.attr(o,"empty")):(t.html(u(e)),t.removeAttr(o)),n.remove()},m=function(e,s){if(!e.is(":editing")){a=e,e.attr("data-is-editing","1"),e.is(":empty")&&(e.removeAttr(o),e.html(""))
var r=t.trim(e.html()),l=e.css("font-size"),d=e.height(),c="width: 96%; padding:0; margin:0; border:0; background:none;font-family: "+e.css("font-family")+"; font-size: "+e.css("font-size")+";font-weight: "+e.css("font-weight")+";"
if(s.lineBreaks&&(r=r.replace(/<br( |)(|\/)>/g,"\n")),n=t("<textarea></textarea>"),e.text(""),null!==navigator.userAgent.match(/webkit/i)&&(c=document.defaultView.getComputedStyle(e.get(0),"").cssText),c+="position: static",!1!==s.tinyMCE){var g="editable-area-"+(new Date).getTime()
n.val(r).appendTo(e).attr("id",g),"object"!=typeof s.tinyMCE&&(s.tinyMCE={}),s.tinyMCE.mode="exact",s.tinyMCE.elements=g,s.tinyMCE.width=e.innerWidth(),s.tinyMCE.height=e.height()+200,s.tinyMCE.theme_advanced_resize_vertical=!0,s.tinyMCE.setup=function(o){o.onInit.add(function(o,l){var d=o.getWin(),c=!1,g=function(){var l=t(o.getDoc()).find("body").html()
t(l).get(0).nodeName==e.get(0).nodeName&&(l=t(l).html()),y(e,l,s.emptyMessage),o.remove(),n=!1,i.unbind("click",g),a=!1,"function"==typeof s.callback&&s.callback({content:!(l==r||!c)&&l,fontSize:!1,$el:e})}
setTimeout(function(){i.bind("click",g)},500),n=t("<textarea></textarea>"),n.bind("blur",g),d.onkeydown=function(){c=!0},d.focus()})},tinyMCE.init(s.tinyMCE)}else(s.toggleFontSize||s.closeOnEnter)&&i.bind("keydown",s,h),i.bind("keyup",f),n.val(r).blur(function(){a=!1
var o=t.trim(n.val()),d=n.css("font-size")
s.lineBreaks&&(o=o.replace(new RegExp("\n","g"),"<br />")),y(e,o,s.emptyMessage),d!=l&&e.css("font-size",d),i.unbind("keydown",h),i.unbind("keyup",f),"function"==typeof s.callback&&s.callback({content:o!=r&&o,fontSize:d!=l&&d,$el:e})}).attr("style",c).appendTo(e).css({margin:0,padding:0,height:d+"px",overflow:"hidden"}).css(s.editorStyle).focus().get(0).select(),f()
e.trigger("edit",[n])}},b=function(e){return!1===a||a.children("textarea").is(p)?m(t(this),e.data):(a.editable("close"),m(t(this),e.data)),!1}
t.fn.editable=function(e){if("string"==typeof e)if(this.is(":editable"))switch(e){case"open":this.is(":editing")||this.trigger(this.attr(s))
break
case"close":this.is(":editing")&&n.trigger("blur")
break
case"destroy":this.is(":editing")&&n.trigger("blur"),this.unbind(this.attr(s)),this.removeAttr(s)
break
default:console.warn('Unknown command "'+e+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first")
else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),e=t.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,emptyMessage:!1,tinyMCE:!1,editorStyle:{}},e),!1===e.tinyMCE||l||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),e.tinyMCE=!1),r&&e.touch?(e.event="dbltap",this.unbind("touchend",g),this.bind("touchend",g)):e.event+=".textEditor",this.bind(e.event,e,b),this.attr(s,e.event),0==this.html().length&&e.emptyMessage?(this.html(e.emptyMessage),this.attr(o,"empty")):this.removeAttr(o)
return this},t.fn.is=function(t){if("string"==typeof t&&0===t.indexOf(":")){if(":editable"==t)return void 0!==this.attr(s)
if(":editing"==t)return void 0!==this.attr("data-is-editing")
if(":empty"==t)return void 0!==this.attr(o)}return d.apply(this,arguments)}
var p
t(document).mousedown(function(e){p=t(e.target)})}(jQuery,window)
