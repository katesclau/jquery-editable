/*
* jQuery plugin that makes elements editable
*
* @author Victor Jonsson (http://victorjonsson.se/)
* @website https://github.com/victorjonsson/jquery-editable/
* @license GPLv2 http://www.gnu.org/licenses/gpl-2.0.html
* @version 1.3.6.dev
* @donations http://victorjonsson.se/donations/
*/
!function(t,e){"use strict"
var i=t(e),n=!1,a=!1,r="data-edit-event",o="data-is-empty",s="ontouchend"in e,l="tinyMCE"in e&&"function"==typeof e.tinyMCE.init,d=t.fn.is,c=0,g=function(){var e=(new Date).getTime()
e-c<250&&t(this).trigger("dbltap"),c=e},h=function(t){if(13==t.keyCode&&t.data.closeOnEnter)a.editable("close")
else if(t.data.toggleFontSize&&t.metaKey&&(38==t.keyCode||40==t.keyCode)){var e=parseInt(n.css("font-size"),10)
return e+=40==t.keyCode?-1:1,n.css("font-size",e+"px"),!1}},u=function(){n[0].scrollHeight!==parseInt(n.attr("data-scroll"),10)&&(n.css("height",n[0].scrollHeight+"px"),n.attr("data-scroll",n[0].scrollHeight))},f=function(t){return t.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},y=function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},m=function(t,e,i){t.removeAttr("data-is-editing"),0==e.length&&i?(t.html(i),t.attr(o,"empty")):(t.html(y(e)),t.removeAttr(o)),n.remove()},p=function(e,r){if(!e.is(":editing")){a=e,e.attr("data-is-editing","1"),e.is(":empty")&&(e.removeAttr(o),e.html(""))
var s=f(t.trim(e.html())),l=e.css("font-size"),d=e.height(),c="width: 96%; padding:0; margin:0; border:0; background:none;font-family: "+e.css("font-family")+"; font-size: "+e.css("font-size")+";font-weight: "+e.css("font-weight")+";"
if(r.lineBreaks&&(s=s.replace(/<br( |)(|\/)>/g,"\n")),n=t("<textarea></textarea>"),e.text(""),null!==navigator.userAgent.match(/webkit/i)&&(c=document.defaultView.getComputedStyle(e.get(0),"").cssText),c+="position: static",!1!==r.tinyMCE){var g="editable-area-"+(new Date).getTime()
n.val(s).appendTo(e).attr("id",g),"object"!=typeof r.tinyMCE&&(r.tinyMCE={}),r.tinyMCE.mode="exact",r.tinyMCE.elements=g,r.tinyMCE.width=e.innerWidth(),r.tinyMCE.height=e.height()+200,r.tinyMCE.theme_advanced_resize_vertical=!0,r.tinyMCE.setup=function(o){o.onInit.add(function(o,l){var d=o.getWin(),c=!1,g=function(){var l=t(o.getDoc()).find("body").html()
t(l).get(0).nodeName==e.get(0).nodeName&&(l=t(l).html()),m(e,l,r.emptyMessage),o.remove(),n=!1,i.unbind("click",g),a=!1,"function"==typeof r.callback&&r.callback({content:!(l==s||!c)&&l,fontSize:!1,$el:e})}
setTimeout(function(){i.bind("click",g)},500),n=t("<textarea></textarea>"),n.bind("blur",g),d.onkeydown=function(){c=!0},d.focus()})},tinyMCE.init(r.tinyMCE)}else(r.toggleFontSize||r.closeOnEnter)&&i.bind("keydown",r,h),i.bind("keyup",u),n.val(s).blur(function(){a=!1
var o=t.trim(n.val()),d=n.css("font-size")
r.lineBreaks&&(o=o.replace(new RegExp("\n","g"),"<br />")),m(e,o,r.emptyMessage),d!=l&&e.css("font-size",d),i.unbind("keydown",h),i.unbind("keyup",u),"function"==typeof r.callback&&r.callback({content:o!=s&&o,fontSize:d!=l&&d,$el:e})}).attr("style",c).appendTo(e).css({margin:0,padding:0,height:d+"px",overflow:"hidden"}).css(r.editorStyle).focus().get(0).select(),u()
e.trigger("edit",[n])}},b=function(e){return!1===a||a.children("textarea").is(v)?p(t(this),e.data):(a.editable("close"),p(t(this),e.data)),!1}
t.fn.editable=function(e){if("string"==typeof e)if(this.is(":editable"))switch(e){case"open":this.is(":editing")||this.trigger(this.attr(r))
break
case"close":this.is(":editing")&&n.trigger("blur")
break
case"destroy":this.is(":editing")&&n.trigger("blur"),this.unbind(this.attr(r)),this.removeAttr(r)
break
default:console.warn('Unknown command "'+e+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first")
else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),e=t.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,emptyMessage:!1,tinyMCE:!1,editorStyle:{}},e),!1===e.tinyMCE||l||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),e.tinyMCE=!1),s&&e.touch?(e.event="dbltap",this.unbind("touchend",g),this.bind("touchend",g)):e.event+=".textEditor",this.bind(e.event,e,b),this.attr(r,e.event),0==this.html().length&&e.emptyMessage?(this.html(e.emptyMessage),this.attr(o,"empty")):this.removeAttr(o)
return this},t.fn.is=function(t){if("string"==typeof t&&0===t.indexOf(":")){if(":editable"==t)return void 0!==this.attr(r)
if(":editing"==t)return void 0!==this.attr("data-is-editing")
if(":empty"==t)return void 0!==this.attr(o)}return d.apply(this,arguments)}
var v
t(document).mousedown(function(e){v=t(e.target)})}(jQuery,window)
